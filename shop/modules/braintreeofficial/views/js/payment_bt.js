/*! For license information please see payment_bt.js.LICENSE */
!function(e){var t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=6)}({0:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return r})),a.d(t,"c",(function(){return i}));var n=function(e){$(".defaultForm").removeClass("bt-settings-link-on"),$(".page-head-tabs a").removeClass("bt-settings-link-on bt__border-b-primary"),e.addClass("bt-settings-link-on"),$("html, body").animate({scrollTop:"".concat(e.offset().top-200,"px")},900)},r=function(){var e=document.querySelectorAll(".page-head-tabs a"),t=$(".page-head-tabs a.current");e.forEach((function(e){var a=$(e).attr("href").includes("AdminBraintreeOfficialCustomizeCheckout"),n=$(e).attr("href").includes("AdminBraintreeOfficialSetup");(t.attr("href").includes("AdminBraintreeOfficialCustomizeCheckout")&&n||t.attr("href").includes("AdminBraintreeOfficialSetup")&&a)&&$(e).addClass("bt-settings-link-on bt__border-b-primary")})),$("html, body").animate({scrollTop:"".concat($(".page-head-tabs").offset().top-200,"px")},900)},i=function(e,t){e&&e.on("change",(function(e){0===e.target.selectedIndex?t.show():t.hide()}))}},6:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _functions_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),bt_hosted_fileds,bt_client_instance;$(document).ready((function(){$("#checkout-payment-step").hasClass("js-current-step")&&(initBraintreeCard(),0==use3dVerification&&initBraintreeCvvField()),$(".js-payment-option-form").each((function(e){var t=e+1,a=$('label[for="payment-option-'.concat(t,'"]'));$("#payment-option-".concat(t,"-additional-information .payment_module")).hasClass("braintree-card")&&(a.addClass("bt__text-left"),a.find("img").css("width","100%"))}))}));var initBraintreeCvvField=function(){var e=$('[data-bt-vaulting-token="bt"]'),t=$("[data-form-cvv-field]");$(document).on("input","#btCvvField",maxLengthCheck),e.length&&toggleCvv(e,t)},maxLengthCheck=function(e){var t=e.target;t.value.length>4&&(t.value=t.value.slice(0,4))},initBraintreeCard=function(){braintree.client.create({authorization:authorization},(function(e,t){if(e)return $("[data-braintree-card-form]").hide(),void $("[data-bt-card-error-msg]").show().text(bt_translations_client);var a=$('[data-bt-vaulting-token="bt"]'),n=$("[data-form-new-card]");a&&Object(_functions_js__WEBPACK_IMPORTED_MODULE_0__.c)(a,n),braintree.hostedFields.create({client:t,styles:{input:{color:"#000",background:"#fff",height:"20px","font-size":"14px","font-family":"PayPal Forward, sans-serif"},".valid":{color:"#349840"}},fields:{number:{selector:"#card-number",placeholder:bt_translations_card_nmb},cvv:{selector:"#cvv",placeholder:"123",maskInput:!0},expirationDate:{selector:"#expiration-date",placeholder:bt_translations_date}}},(function(e,a){e?$("[data-bt-card-error-msg]").show().text(bt_translations_hosted):(a.on("empty",(function(e){$(".braintree-card #card-image").removeClass()})),a.on("cardTypeChange",(function(e){1===e.cards.length&&$(".braintree-card #card-image").removeClass().addClass(e.cards[0].type),4===e.cards[0].code.size&&a.setAttribute({field:"cvv",attribute:"placeholder",value:"1234"})})),a.on("blur",(function(e){var t=e.fields[e.emittedBy];!t.isEmpty&&t.isValid||setErrorMsg(e.emittedBy,t)})),a.on("focus",(function(e){var t=e.fields[e.emittedBy];removeErrorMsg($("#".concat(t.container.id)))})),a.on("validityChange",(function(e){var t=e.fields[e.emittedBy];if($("[data-bt-card-error-msg]").text("").hide(),t.isValid)switch(removeErrorMsg($("#".concat(t.container.id))),e.emittedBy){case"number":a.focus("expirationDate");break;case"expirationDate":a.focus("cvv");break;case"cvv":$("#".concat(t.container.id)).removeClass("braintree-hosted-fields-focused")}else t.isPotentiallyValid?removeErrorMsg($("#".concat(t.container.id))):setErrorMsg(e.emittedBy,t)})),$("[data-bt-field]").on("click",(function(e){a.focus(e.currentTarget.dataset.btField)})),bt_hosted_fileds=a,bt_client_instance=t)}))}))},toggleCvv=function(e,t){e&&e.on("change",(function(e){0===e.target.selectedIndex?t.hide():t.show()}))},removeErrorMsg=function(e){e.removeClass("braintree-hosted-fields-valid"),e.parent().find("[data-bt-error-msg]").hide()},setErrorMsg=function setErrorMsg(el,field){var popup_message="",$el=$("#".concat(field.container.id)),$msgBlock=$el.parent().find("[data-bt-error-msg]");field.isEmpty?popup_message="".concat(eval("bt_translations_".concat(el))," ").concat("cvv"!==field.container.id?"".concat(bt_translations_empty_field):""):field.isValid||(popup_message="".concat(eval("bt_translations_".concat(el))," ").concat(bt_translations_invalid)),popup_message?($el.addClass("braintree-hosted-fields-invalid"),$msgBlock.show(),$msgBlock.html(popup_message)):($el.removeClass("braintree-hosted-fields-invalid"),$msgBlock.hide())},BraintreeSubmitPayment=function(){var e=$("[data-braintree-card-form]"),t=$('[data-bt-vaulting-token="bt"]').val(),a=$("#payment-confirmation button"),n=$('[name = "btCvvField"]');getOrderInformation(t).then((function(r){var i=r.orderInformation,o=r.payload;if(r.use3dVerification)braintree.threeDSecure.create({version:2,client:bt_client_instance},(function(t,n){if(t){switch(a.prop("disabled",!1),t.code){case"THREEDS_HTTPS_REQUIRED":popup_message=bt_translations_https;break;default:popup_message=bt_translations_load_3d}return $("[data-bt-card-error-msg]").show().text(popup_message),!1}n.verifyCard(i,(function(t,n){var r="";if(t){switch(a.prop("disabled",!1),t.code){case"CLIENT_REQUEST_ERROR":r=bt_translations_request_problem;break;default:r=bt_translations_failed_3d}return $("[data-bt-card-error-msg]").show().text(r),!1}return 0==n.liabilityShifted&&1==n.liabilityShiftPossible?(a.prop("disabled",!1),r=bt_translations_3ds_failed_1,$("[data-bt-card-error-msg]").show().text(r),!1):0==n.liabilityShifted?(a.prop("disabled",!1),r=bt_translations_3ds_failed_2,$("[data-bt-card-error-msg]").show().text(r),!1):($('[data-payment-method-nonce="bt"]').val(n.nonce),$("[data-bt-card-type]").val(n.details.cardType),void e.submit())}))}));else{if(void 0===t||0==t)$('[data-payment-method-nonce="bt"]').val(o.nonce),$("[data-bt-card-type]").val(o.details.cardType);else if(t&&(0==n.length||""==n.val()))return a.prop("disabled",!1),$("[data-bt-cvv-error-msg]").show().text(bt_translations_cvv),!1;e.submit()}}),(function(e){a.prop("disabled",!1),$("[data-bt-card-error-msg]").show().text(e)})).catch((function(e){a.prop("disabled",!1),console.log(e)}))};function getOrderInformation(e){return new Promise((function(t,a){$.ajax({url:controllerValidation,type:"POST",dataType:"JSON",data:{ajax:!0,action:"getOrderInformation"},success:function(n){"success"in n&&1==n.success&&(n.orderInformation.onLookupComplete=function(e,t){t()},e?(n.orderInformation.nonce=$('[data-bt-vaulting-token="bt"] option:checked').data("nonce"),t(n)):bt_hosted_fileds.tokenize((function(e,r){if(e){Object.entries(bt_hosted_fileds._state.fields).forEach((function(e){setErrorMsg(e[0],e[1])}));var i="";if("HOSTED_FIELDS_FIELDS_EMPTY"!==e.code&&"HOSTED_FIELDS_FIELDS_INVALID"!==e.code){switch(e.code){case"HOSTED_FIELDS_FAILED_TOKENIZATION":i=bt_translations_token;break;case"HOSTED_FIELDS_TOKENIZATION_NETWORK_ERROR":i=bt_translations_network;break;default:i=bt_translations_tkn_failed}a(i)}}else n.orderInformation.nonce=r.nonce,n.orderInformation.bin=r.details.bin,n.payload=r,t(n)})))}})}))}window.BraintreeSubmitPayment=BraintreeSubmitPayment}});
//# sourceMappingURL=payment_bt.js.map